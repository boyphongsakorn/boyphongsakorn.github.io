<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWisetthon</title>
    <meta name="google-adsense-account" content="ca-pub-9734327609923498">
    <script defer src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-2 text-gray-800">PWisetthon</h1>
        <p class="text-gray-600 mb-6">ขี้เกียจทำละเว็บ กดตาม ul list ข้างล่างละกัน</p>
        
        <ul class="space-y-3">
            <li id="twitchbanneralert" class="hidden">
                <a href="https://www.twitch.tv/boyalone99" target="_blank" rel="noopener noreferrer" class="lazy block p-4 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 border border-gray-200 bg-cover bg-center" data-bg="https://img.gs/fhcphvsghs/quality=low/https://static-cdn.jtvnw.net/previews-ttv/live_user_boyalone99-1280x720.jpg" style="background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(2px);">
                    <img class="w-10 h-10 rounded-full inline mr-2" src="https://upload.wikimedia.org/wikipedia/commons/4/41/Red_circle.gif" alt="Live indicator">
                    <span class="text-blue-600 font-medium">กำลังไลฟ์ อยู่บน Twitch - ดูเลย!</span>
                </a>
            </li>
            <li><a href="https://store.line.me/themeshop/product/2e590572-878f-484e-a4d6-6c6cff4a55fb/th" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">ธีมไลน์ง่ายดี (ธีมมืด)</span>
            </a></li>
            <li id="twitchregularlink"><a href="https://www.twitch.tv/boyalone99" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Twitch.tv</span>
            </a></li>
            <li><a href="https://www.fortnite.com/@boyalone99" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Fortnite Creator</span>
            </a></li>
            <li><a href="https://play.google.com/store/apps/details?id=com.wrblob" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">อยากรวย แต่มีแต่รายจ่าย</span>
            </a></li>
            <li><a href="https://bpminecraft.com" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">BP Minecraft</span>
            </a></li>
            <li><a href="https://mccplog.pwisetthon.com" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Log เซิฟเวอร์ Minecraft</span>
            </a></li>
            <li><a href="https://bussy.pwisetthon.com" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Busy (เว็บรวมตารางงาน)</span>
            </a></li>
            
            <!-- Toggle button for card bottom section -->
            <li class="flex justify-center">
                <button id="toggleCardBottom" class="p-2 text-gray-600 hover:text-gray-800 transition-all duration-200 focus:outline-none">
                    <svg id="toggleIcon" class="w-6 h-6 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
            </li>
            
            <!-- Collapsible card bottom section -->
            <li id="cardBottomSection" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4">
                    <!-- Box 1 -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 min-h-[150px]">
                        <!-- Placeholder for box 1 -->
                    </div>
                    <!-- Box 2 -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 min-h-[150px]">
                        <!-- Placeholder for box 2 -->
                    </div>
                    <!-- Box 3 -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 min-h-[150px]">
                        <!-- Placeholder for box 3 -->
                    </div>
                </div>
            </li>
            
            <li><a href="https://send.pwisetthon.com" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Send (เว็บฝากไฟล์ชั่วคราว)</span>
            </a></li>
            <li><a href="https://discordbot.pwisetthon.com" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Discord Bot</span>
            </a></li>
            <li><a href="https://www.battlemetrics.com/servers/palworld/33185507" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Free Palworld Server</span>
            </a></li>
            <li><a href="https://mkrm.pwisetthon.com" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 border border-gray-200">
                <span class="text-blue-600 font-medium">Project สแกนเพิ่ม Playlist เพลง</span>
            </a></li>
        </ul>

        <!-- Steam Wishlist Section -->
        <div id="steamWishlistSection" class="mt-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Steam Wishlist</h2>
            <div id="steamWishlistLoading" class="text-gray-600">Loading wishlist...</div>
            <div id="steamWishlistError" class="hidden text-red-600"></div>
            <div id="steamWishlistContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.min.js"></script>

    <script defer>
        const lazyLoadInstance = new LazyLoad({
            elements_selector: ".lazy"
        });

        //fetch https://localpost.teamquadb.in.th/twitchstatus and if text is not "offline" then show the list item
        fetch('https://localpost.teamquadb.in.th/twitchstatus')
            .then(response => response.text())
            .then(data => {
                if (data != "offline") {
                    // remove class hidden from Twitch banner list item
                    document.getElementById("twitchbanneralert").classList.remove("hidden");
                    // hide the regular Twitch link when live banner is shown
                    document.getElementById("twitchregularlink").style.display = "none";
                }
            })
            .catch(error => {
                // Silently fail - banner remains hidden if API is unavailable
                console.error('Error fetching Twitch status:', error);
            });

        // Card Bottom Toggle Functionality
        const toggleButton = document.getElementById('toggleCardBottom');
        const toggleIcon = document.getElementById('toggleIcon');
        const cardBottomSection = document.getElementById('cardBottomSection');
        
        toggleButton.addEventListener('click', function() {
            // Toggle the hidden class
            cardBottomSection.classList.toggle('hidden');
            
            // Rotate the icon (180 degrees when expanded)
            if (cardBottomSection.classList.contains('hidden')) {
                toggleIcon.classList.remove('rotate-180');
            } else {
                toggleIcon.classList.add('rotate-180');
            }
        });

        // Steam Wishlist Functionality
        async function fetchSteamWishlist() {
            const apiKey = '22EEAC69A8668511FB364F212A0231B8';
            const steamId = '76561198069538631';
            const loadingEl = document.getElementById('steamWishlistLoading');
            const errorEl = document.getElementById('steamWishlistError');
            const contentEl = document.getElementById('steamWishlistContent');

            try {
                // Fetch wishlist data from Steam API
                const response = await fetch(`https://anywhere.pwisetthon.com/https://api.steampowered.com/IWishlistService/GetWishlist/v1/?key=${apiKey}&steamid=${steamId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch wishlist');
                }

                const data = await response.json();
                
                // Hide loading message
                loadingEl.style.display = 'none';

                // Check if wishlist is empty
                if (!data.response || !data.response.items || data.response.items.length === 0) {
                    contentEl.innerHTML = '<p class="text-gray-600">No games in wishlist</p>';
                    return;
                }

                // Fetch game details for all apps in wishlist
                const games = data.response.items;
                
                // Fetch game details for all apps concurrently
                const gameDetailsPromises = games.map(async (item) => {
                    const appId = item.appid;
                    
                    try {
                        // Fetch game details from Steam Store API
                        const detailsResponse = await fetch(`https://anywhere.pwisetthon.com/https://store.steampowered.com/api/appdetails?appids=${appId}&cc=th`);
                        
                        // Validate HTTP response
                        if (!detailsResponse.ok) {
                            console.error(`HTTP error fetching app ${appId}: ${detailsResponse.status}`);
                            return null;
                        }
                        
                        const detailsData = await detailsResponse.json();
                        
                        // Check if data is available for this app
                        if (!detailsData[appId] || !detailsData[appId].success) {
                            return null;
                        }
                        
                        const gameData = detailsData[appId].data;
                        const gameName = gameData.name;
                        
                        // Get price information
                        let priceText = 'Price not available';
                        let hasDiscount = false;
                        let originalPrice = '';
                        let discountPercent = '';
                        let discountValue = 0;
                        
                        if (gameData.is_free) {
                            priceText = 'Free to Play';
                        } else if (gameData.price_overview) {
                            const priceOverview = gameData.price_overview;
                            priceText = priceOverview.final_formatted;
                            
                            // Check if there's a discount
                            if (priceOverview.discount_percent > 0) {
                                hasDiscount = true;
                                originalPrice = priceOverview.initial_formatted;
                                discountPercent = `-${priceOverview.discount_percent}%`;
                                discountValue = priceOverview.discount_percent;
                            }
                        }
                        
                        return { appId, gameName, priceText, hasDiscount, originalPrice, discountPercent, discountValue };
                    } catch (error) {
                        console.error(`Error fetching details for app ${appId}:`, error);
                        return null;
                    }
                });
                
                // Wait for all game details to be fetched
                const gameDetails = await Promise.all(gameDetailsPromises);
                
                // Filter out failed fetches and sort by discount percentage (highest first)
                const validGameDetails = gameDetails
                    .filter(details => details !== null)
                    .sort((a, b) => b.discountValue - a.discountValue)
                    .slice(0, 3); // Take top 3 games with most discount
                
                validGameDetails.forEach((details) => {
                    const { appId, gameName, priceText, hasDiscount, originalPrice, discountPercent } = details;
                    
                    const gameCard = document.createElement('div');
                    gameCard.className = 'bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-200 border border-gray-200 overflow-hidden';
                    
                    // Create link element
                    const link = document.createElement('a');
                    link.href = `https://store.steampowered.com/app/${appId}`;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.className = 'block';
                    
                    // Create and add image (thumbnail)
                    const img = document.createElement('img');
                    // Steam app images are available at this URL format
                    img.src = `https://cdn.cloudflare.steamstatic.com/steam/apps/${appId}/header.jpg`;
                    img.alt = gameName;
                    img.className = 'w-full h-40 object-cover';
                    img.onerror = function() { this.style.display = 'none'; };
                    link.appendChild(img);
                    
                    // Create content div with game name and price
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'p-3';
                    
                    // Create a flex container for title and price
                    const titlePriceContainer = document.createElement('div');
                    titlePriceContainer.className = 'flex items-center justify-between gap-2';
                    
                    // Create title
                    const title = document.createElement('h3');
                    title.className = 'font-medium text-gray-800 truncate flex-1';
                    title.textContent = gameName;
                    titlePriceContainer.appendChild(title);
                    
                    // Create price container (on the right)
                    const priceContainer = document.createElement('div');
                    priceContainer.className = 'text-right flex-shrink-0';
                    
                    // If there's a discount, show original price and discount
                    if (hasDiscount) {
                        // Original price (strikethrough)
                        const originalPriceEl = document.createElement('div');
                        originalPriceEl.className = 'text-xs text-gray-500 line-through';
                        originalPriceEl.textContent = originalPrice;
                        priceContainer.appendChild(originalPriceEl);
                        
                        // Discount percent and final price container
                        const discountContainer = document.createElement('div');
                        discountContainer.className = 'flex items-center gap-1';
                        
                        // Discount badge
                        const discountBadge = document.createElement('span');
                        discountBadge.className = 'text-xs bg-green-600 text-white px-1 rounded font-semibold';
                        discountBadge.textContent = discountPercent;
                        discountContainer.appendChild(discountBadge);
                        
                        // Final price
                        const finalPrice = document.createElement('span');
                        finalPrice.className = 'text-sm text-green-600 font-semibold';
                        finalPrice.textContent = priceText;
                        discountContainer.appendChild(finalPrice);
                        
                        priceContainer.appendChild(discountContainer);
                    } else {
                        // No discount, just show the price
                        const price = document.createElement('div');
                        price.className = 'text-sm text-blue-600 font-semibold';
                        price.textContent = priceText;
                        priceContainer.appendChild(price);
                    }
                    
                    titlePriceContainer.appendChild(priceContainer);
                    contentDiv.appendChild(titlePriceContainer);
                    
                    link.appendChild(contentDiv);
                    gameCard.appendChild(link);
                    contentEl.appendChild(gameCard);
                });

            } catch (error) {
                console.error('Error fetching Steam wishlist:', error);
                loadingEl.style.display = 'none';
                errorEl.textContent = 'Unable to load Steam wishlist. Please try again later.';
                errorEl.classList.remove('hidden');
            }
        }

        // Load Steam wishlist when page loads
        fetchSteamWishlist();
    </script>
</body>
</html>
